<!DOCTYPE html>
<html lang="ar" dir="rtl" data-theme="light">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø·Ù„Ø¨Ùƒ</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;800&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#f7f8fc; --card:#ffffff; --text:#1b2333; --muted:#5b6477; --ring:#d7dced; --accent:#C99A00;
    --ok:#0b704a; --err:#7a1d1d; --okbg:#e9f8f1; --errbg:#fdecec;
  }
  html[data-theme="dark"]{
    --bg:#0f1220; --card:#14182a; --text:#eef1ff; --muted:#aeb6cf; --ring:#2a3350;
  }
  *{box-sizing:border-box}
  body{
    margin:0; background:var(--bg); font-family:'Cairo',system-ui;
    color:var(--text); min-height:100vh; display:flex; align-items:center; justify-content:center; padding:20px;
    transition: background .2s ease, color .2s ease;
  }
  .wrap{width:100%; max-width:720px}
  .topbar{display:flex; justify-content:flex-end; gap:8px; margin-bottom:10px}
  .tbtn{background:var(--card); color:var(--text); border:1px solid var(--ring); border-radius:10px; padding:8px 12px; cursor:pointer; font-weight:700}
  .card{
    background:var(--card); border:1px solid var(--ring); border-radius:16px; padding:26px;
    text-align:center; box-shadow:0 8px 28px rgba(16,24,40,.06)
  }
  h1{margin:0 0 10px; font-size:28px; background:linear-gradient(90deg,var(--accent), #FFD54A 35%, #B8860B); -webkit-background-clip:text; background-clip:text; color:transparent;}
  p{margin:8px 0; color:var(--muted)}
  .ticket{display:inline-flex; align-items:center; gap:10px; border:1px dashed var(--ring); padding:10px 14px; border-radius:12px; font-weight:800; font-size:18px; margin:10px 0}
  .row{display:flex; gap:10px; justify-content:center; flex-wrap:wrap; margin-top:12px}
  .btn{border:none; cursor:pointer; border-radius:12px; padding:10px 16px; font-weight:700; background:#eef1ff; border:1px solid var(--ring)}
  .link{display:inline-block; text-decoration:none; padding:10px 16px; border-radius:12px; border:1px solid var(--ring); background:#eef1ff; color:inherit}
  .msg{margin-top:10px; display:none; padding:10px 12px; border-radius:10px; font-weight:700}
  .ok{color:var(--ok); background:var(--okbg)}
  .err{color:var(--err); background:var(--errbg)}
  .status{font-weight:800}
</style>
</head>
<body>
  <div class="wrap">
    <div class="topbar">
      <button id="langBtn" class="tbtn">English</button>
      <button id="themeBtn" class="tbtn">ğŸŒ™</button>
    </div>

    <div class="card">
      <h1 id="hTitle">Ø´ÙƒØ±Ù‹Ø§! âœ…</h1>
      <p id="pIntro">ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø·Ù„Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­. Ø§Ø­ØªÙØ¸ Ø¨Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯ Ù„ØªØªØ¨Ù‘ÙØ¹ Ø­Ø§Ù„ØªÙƒ:</p>

      <div class="ticket"><span id="lblTicket">Ticket ID:</span> <code id="tid">â€”</code></div>

      <div class="row">
        <button class="btn" id="copyBtn">Ù†Ø³Ø® Ø§Ù„ÙƒÙˆØ¯</button>
        <button class="btn" id="trackBtn">ØªØªØ¨Ù‘Ø¹ Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø¢Ù†</button>
        <a class="link" href="./" id="backHome">Ø±Ø¬ÙˆØ¹ Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
      </div>

      <p class="msg ok" id="msgOk">ØªÙ… Ø§Ù„Ù†Ø³Ø® âœ…</p>
      <p class="msg err" id="msgErr">ØªØ¹Ø°Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù….</p>
      <p class="msg err" id="msgNoTicket">Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙƒÙˆØ¯ ÙÙŠ Ø§Ù„Ø±Ø§Ø¨Ø·. Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ø±Ø¬ÙˆØ¹ Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ÙˆØ¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¥Ø±Ø³Ø§Ù„.</p>

      <div id="trackResult" style="display:none; margin-top:14px">
        <p><span id="lblCurrent">Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©:</span> <span class="status" id="currStatus">â€”</span></p>
      </div>
    </div>
  </div>

<script>
  // ===== Config =====
  const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzb6QmbgguRd5ZEfGmAHkNwEzbXs4TdVW1m-8TLAX4wk19qx4lY7b4BYyI4g2kq4T0yIA/exec";

  // ===== i18n =====
  const i18n = {
    ar: {
      title:"Ø´ÙƒØ±Ù‹Ø§! âœ…",
      intro:"ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø·Ù„Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­. Ø§Ø­ØªÙØ¸ Ø¨Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯ Ù„ØªØªØ¨Ù‘ÙØ¹ Ø­Ø§Ù„ØªÙƒ:",
      ticket:"Ticket ID:",
      copy:"Ù†Ø³Ø® Ø§Ù„ÙƒÙˆØ¯",
      track:"ØªØªØ¨Ù‘Ø¹ Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø¢Ù†",
      back:"Ø±Ø¬ÙˆØ¹ Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©",
      copied:"ØªÙ… Ø§Ù„Ù†Ø³Ø® âœ…",
      err:"ØªØ¹Ø°Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù….",
      noticket:"Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙƒÙˆØ¯ ÙÙŠ Ø§Ù„Ø±Ø§Ø¨Ø·. Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„Ø±Ø¬ÙˆØ¹ Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ÙˆØ¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¥Ø±Ø³Ø§Ù„.",
      current:"Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©:"
    },
    en: {
      title:"Thanks! âœ…",
      intro:"We received your submission. Keep this code to track your status:",
      ticket:"Ticket ID:",
      copy:"Copy Code",
      track:"Track Status",
      back:"Back to Home",
      copied:"Copied âœ…",
      err:"Couldnâ€™t reach the server.",
      noticket:"No ticket found in the link. Please go back and resubmit.",
      current:"Current status:"
    }
  };
  let lang = localStorage.getItem("lang") || "ar";

  function applyLang(){
    const t = i18n[lang];
    document.documentElement.lang = lang;
    document.documentElement.dir = (lang==="ar" ? "rtl" : "ltr");
    document.getElementById("langBtn").textContent = (lang==="ar") ? "English" : "Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©";

    hTitle.textContent = t.title;
    pIntro.textContent = t.intro;
    lblTicket.textContent = t.ticket;
    copyBtn.textContent = t.copy;
    trackBtn.textContent = t.track;
    backHome.textContent = t.back;
    msgOk.textContent = t.copied;
    msgErr.textContent = t.err;
    msgNoTicket.textContent = t.noticket;
    lblCurrent.textContent = t.current;
  }

  function applyTheme(){
    const saved = localStorage.getItem("theme") || "light";
    document.documentElement.setAttribute("data-theme", saved);
    document.getElementById("themeBtn").textContent = (saved==="dark") ? "â˜€ï¸" : "ğŸŒ™";
  }

  // ===== Helpers =====
  function getParam(name){ return new URLSearchParams(window.location.search).get(name) || ""; }
  function show(el, on=true){ el.style.display = on ? "block" : "none"; }

  // ===== Init ticket
  const tid = getParam("ticket");
  const tidEl = document.getElementById("tid");
  const trackBtn = document.getElementById("trackBtn");
  const msgNoTicket = document.getElementById("msgNoTicket");
  tidEl.textContent = tid || "â€”";
  if (!tid){
    show(trackBtn, false);
    show(msgNoTicket, true);
  }

  // ===== Copy
  const msgOk = document.getElementById("msgOk");
  document.getElementById("copyBtn").addEventListener("click", async ()=>{
    if (!tid) return;
    try{
      await navigator.clipboard.writeText(tid);
      show(msgOk, true); setTimeout(()=>show(msgOk,false), 2000);
    }catch{}
  });

  // ===== Track
  const msgErr = document.getElementById("msgErr");
  const trackResult = document.getElementById("trackResult");
  const currStatus = document.getElementById("currStatus");

  trackBtn.addEventListener("click", async ()=>{
    if (!tid) return;
    show(msgErr, false);
    try{
      const res = await fetch(`${SCRIPT_URL}?id=${encodeURIComponent(tid)}`);
      const json = await res.json().catch(()=> ({}));

      // Ù…ØªÙˆÙ‚Ø¹ ØªØ±Ø¬Ø¹ { status: "success"|"not_found"|"error", applicationStatus: "Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©"|"Ù…Ù‚Ø¨ÙˆÙ„"|... }
      if (json.status === "success"){
        currStatus.textContent = json.applicationStatus || "â€”";
        show(trackResult, true);
      } else if (json.status === "not_found"){
        currStatus.textContent = (lang==="ar" ? "Ø§Ù„ÙƒÙˆØ¯ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯" : "Ticket not found");
        show(trackResult, true);
      } else {
        show(msgErr, true);
      }
    }catch(e){
      show(msgErr, true);
    }
  });

  // ===== Lang & Theme toggles
  document.getElementById("langBtn").addEventListener("click", ()=>{
    lang = (lang==="ar") ? "en" : "ar";
    localStorage.setItem("lang", lang);
    applyLang();
  });
  document.getElementById("themeBtn").addEventListener("click", ()=>{
    const curr = document.documentElement.getAttribute("data-theme") || "light";
    const next = (curr==="light") ? "dark" : "light";
    localStorage.setItem("theme", next);
    applyTheme();
  });

  // ===== Apply
  applyTheme();
  applyLang();
</script>
</body>
</html>
